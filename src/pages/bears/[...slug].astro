---
import { type CollectionEntry, getCollection, getEntry } from "astro:content";
import PageLayout from "../../layouts/page.layout.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
    const bearsCollection: CollectionEntry<"bears">[] =
        await getCollection("bears");
    return bearsCollection.map((item) => ({
        params: { slug: item.slug },
        props: item,
    }));
}
type Props = CollectionEntry<"bears">;

const bear = Astro.props;

const { name, picture, status, uploadedOn } = bear.data;

const { Content } = await bear.render();
---

<PageLayout title={name}>
    <section class="py-8 bg-white md:py-16 dark:bg-gray-900 antialiased">
        <div class="max-w-screen-xl px-4 mx-auto 2xl:px-0">
            <div class="lg:grid lg:grid-cols-2 lg:gap-8 xl:gap-16">
                <div class="shrink-0 max-w-md lg:max-w-lg mx-auto">
                    <Image
                        class="w-full rounded"
                        loading={"lazy"}
                        src={picture}
                        alt={"A picture of " + name}
                        quality={100}
                    />
                </div>

                <div class="mt-6 sm:mt-8 lg:mt-0">
                    <h1
                        class="text-2xl font-extrabold text-gray-900 sm:text-3xl dark:text-white"
                    >
                        {name}
                    </h1>
                    <div class="mt-4 sm:items-center sm:gap-4 sm:flex">
                        <p
                            class="text-lg font-semibold text-gray-900 sm:text-xl dark:text-white"
                        >
                            {
                                status == "rehomed"
                                    ? "At their forever home"
                                    : "Awaiting their forever home"
                            }
                        </p>
                    </div>

                    <dl
                        class="my-6 md:my-8 text-gray-900 divide-y divide-gray-200 dark:text-white dark:divide-gray-700"
                    >
                        <div class="flex flex-col pb-3">
                            <dt
                                class="mb-1 text-gray-500 md:text-lg dark:text-gray-400"
                            >
                                Brand
                            </dt>
                            <dd class="text-lg font-semibold">
                                <a
                                    href={`/bears/by/brand/${bear.data.info.brand.slug}`}
                                >
                                    {bear.data.info.brand.slug}
                                </a>
                            </dd>
                        </div>
                        <div class="flex flex-col py-3">
                            <dt
                                class="mb-1 text-gray-500 md:text-lg dark:text-gray-400"
                            >
                                Species
                            </dt>
                            <dd class="text-lg font-semibold">
                                <a
                                    href={`/bears/by/species/${bear.data.info.species.slug}`}
                                >
                                    {bear.data.info.species.slug}
                                </a>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
        </div>

        <ol
            class="my-6 md:my-8 relative border-s border-gray-200 dark:border-gray-700"
        >
            {
                bear.data.rehomed && (
                    <>
                        <li class="mb-10 ms-4">
                            <div class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -start-1.5 border border-white dark:border-gray-900 dark:bg-gray-700" />
                            <time class="mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">
                                {bear.data.rehomed.date}
                            </time>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                {name} was rehomed in{" "}
                                <a
                                    href={`/bears/by/location/${bear.data.rehomed.location.slug}`}
                                    class="font-medium text-blue-600 dark:text-blue-500 hover:underline"
                                >
                                    {bear.data.rehomed.location.slug}
                                </a>
                            </h3>
                        </li>
                    </>
                )
            }
            {
                bear.data.event && (
                    <>
                        <li class="mb-10 ms-4">
                            <div class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -start-1.5 border border-white dark:border-gray-900 dark:bg-gray-700" />
                            <time class="mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">
                                {bear.data.rescued.date}
                            </time>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                {name} was rescued from{" "}
                                <a
                                    href={`/bears/by/event/${bear.data.event.slug}`}
                                    class="font-medium text-blue-600 dark:text-blue-500 hover:underline"
                                >
                                    {bear.data.event.slug}
                                </a>
                            </h3>
                        </li>
                    </>
                )
            }
            List all the events they went to

            {
                uploadedOn && (
                    <>
                        <li class="mb-10 ms-4">
                            <div class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -start-1.5 border border-white dark:border-gray-900 dark:bg-gray-700" />
                            <time class="mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">
                                {uploadedOn}
                            </time>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                {name} was added to the website!
                            </h3>
                        </li>
                    </>
                )
            }

            {
                bear.data.rescued && (
                    <>
                        <li class="mb-10 ms-4">
                            <div class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -start-1.5 border border-white dark:border-gray-900 dark:bg-gray-700" />
                            <time class="mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">
                                {bear.data.rescued.date}
                            </time>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                {name} was rescued from{" "}
                                <a
                                    href={`/bears/by/location/${bear.data.rescued.location.slug}`}
                                    class="font-medium text-blue-600 dark:text-blue-500 hover:underline"
                                >
                                    {bear.data.rescued.location.slug}
                                </a>
                            </h3>
                        </li>
                    </>
                )
            }
        </ol>
    </section>
</PageLayout>
